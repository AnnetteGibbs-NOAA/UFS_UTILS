<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>chgres_cube: Main Page</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">chgres_cube
   &#160;<span id="projectnumber">1.6.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li class="current"><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Types&#160;List</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('index.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">chgres_cube Documentation</div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1>Introduction</h1>
<p>The program <a class="el" href="chgres_8F90.html" title="Initialize an FV3 model run. ">chgres.F90</a> creates initial condition files to “coldstart” the forecast model. The initial conditions are created from either Global Forecast System (GFS) gridded binary version 2 (GRIB2), NOAA Environmental Modeling System Input/Output (NEMSIO) data, or Network Common Data Form (NetCDF) data.</p>
<p>This document is part of the <a href="../index.html">UFS_UTILS documentation</a>.</p>
<p>The chgres_cube program is part of the <a href="https://github.com/ufs-community/UFS_UTILS">UFS_UTILS</a> project.</p>
<h2>Where to find GFS GRIB2, NEMSIO and NetCDF data</h2>
<h3>GRIB2</h3>
<ul>
<li>0.25-degree data (last 10 days only) - Use the <b>gfs.tHHz.pgrb2.0p25.f000</b> files in subdirectory <b>gfs.YYYYMMDD/HH</b> here: <a href="https://nomads.ncep.noaa.gov/pub/data/nccf/com/gfs/prod">https://nomads.ncep.noaa.gov/pub/data/nccf/com/gfs/prod</a>.</li>
<li>0.5-degree data - Use the <b>gfs_4_YYYYMMDD_00HH_000.grb2</b> file, under <b>GFS Forecasts 004 (0.5-deg)</b> from the NCDC - Global Forecast System <a href="https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs">https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs</a>. Note: Tests were not done with the AVN, MRF or analysis data.</li>
<li>1.0-degree data - Use the <b>gfs_3_YYYYMMDD_00HH_000.grb2 file</b>, under <b>GFS Forecasts 003 (1-deg)</b> from NCDC - Global Forecast System <a href="https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs">https://www.ncdc.noaa.gov/data-access/model-data/model-datasets/global-forcast-system-gfs</a>. Note: Tests were not done with the AVN, MRF or analysis data.</li>
</ul>
<h3>NEMSIO</h3>
<ul>
<li>T1534 gaussian (last 10 days only) - Use the <b>gfs.tHHz.atmanl.nemsio</b> (atmospheric fields) and <b>gfs.tHHz.sfcanl.nemsio</b> (surface fields) files in subdirectory gfs.YYYYMMDD/HH from <a href="https://nomads.ncep.noaa.gov/pub/data/nccf/com/gfs/prod">https://nomads.ncep.noaa.gov/pub/data/nccf/com/gfs/prod</a>.</li>
</ul>
<h3>NetCDF</h3>
<ul>
<li>T1534 gaussian (don't have any more details at this time).</li>
</ul>
<h1>Initializing with GRIB2 data - some caveats</h1>
<p>Keep this in mind when using GFS GRIB2 data for model initialization:</p>
<ul>
<li>GRIB2 data does not contain the fields needed for the Near Sea Surface Temperature (NSST) scheme. See the next section for options on running the forecast model in this situation.</li>
<li>Data is coarse (in vertical and horizontal) compared to the NCEP operational GFS . May not provide a good initialization (especially for the surface). Recommendations:<ul>
<li>C96 - use 0.25, 0.5 or 1.0-degree GRIB2 data</li>
<li>C192 - use 0.25 or 0.5-degree GRIB2 data</li>
<li>C384 - use 0.25-degree GRIB2 data</li>
<li>C768 - try the 0.25-degree GRIB2 data. But it may not work well.</li>
</ul>
</li>
<li>Sea/lake ice thickness and column temperatures are not available. So, nominal values of 1.5 m and 265 K are used.</li>
<li>Soil moisture in the GRIB2 files is created using bilinear interpolation and, therefore, may be a mixture of values from different soil types. Could result in poor latent/sensible heat fluxes.</li>
<li>Ozone is not available at all isobaric levels. Missing levels are set to a nominal value defined in the variable mapping (VARMAP) file (1E-07).</li>
<li>Only tested with GRIB2 data from GFS v14 and v15 (from 12z July 19, 2017 to current). May not work with older GFS data. Will not work with GRIB2 data from other models.</li>
</ul>
<h3>Near Sea Surface Temperature (NSST) data and GRIB2 initialization</h3>
<p>The issue with not having NSST data is important. In GFS we use the foundation temperature (Tref) and add a diurnal warming/cooling layer using NSST. This is the surface temperature that is passed to the atmospheric boundary layer. This is a critical feature, especially when we are doing Data Assimilation.</p>
<p>When using NEMSIO or NetCDF data to initialize the model, both the foundation and surface temperature are available and the atmospheric model should be run using the NSST option as this will properly account for in the forward run of the model.</p>
<p>In GRIB2 files only the Tsfc is stored and that is set as foundation temperature as well. So the diurnal heating / cooling is baked into the initial condition for the extent of the run. This can be critical if the model is being initialized when the ocean is warm and initialization is occuring at the peak of the diurnal warming. That warm ocean will be baked in for the extent of the run and may spawn off a number of fake hurricanes. The user has two options &ndash; either to use a spin up cycle to spin up NSST (set <b>nstf_name</b> = [2,1,0,0,0] in <b>input.nml</b> of the model namelist file. This will create a diurnal cycle after 24 hours of spin up), or to run the model without any NSST option ( set <b>nstf_name</b> = [0,0,0,0,0] in <b>input.nml</b> of the model namelist file. The user will also have to choose one of the no NSST physics suite options in <b>input.nml</b>).</p>
<p>Note, that neither of these two options will get rid of the underlying baked in heating/cooling in the surface temperature fields. For most cases this may not be an issue, but where it is then the user will either have to initialize the model with NEMSIO or NetCDF data, or replace the surface temperature in the GRIB2 fields with independently obtained foundation temperature.</p>
<h1>chgres_cube namelist options</h1>
<p>Namelist variables with “input” in their name refer to data input to chgres_cube. Namelist variables with “target” in their name refer to the FV3 horizontal and vertical grid (i.e., the target grid chgres_cube is mapping to).</p>
<p>When using GRIB2 data as input to chgres_cube, set namelist as follows:</p>
<ul>
<li>fix_dir_target_grid - Path to the tiled FV3 surface climatological files (such as albedo).</li>
<li>mosaic_file_target_grid - Path and name of the FV3 mosaic file.</li>
<li>orog_dir_target_grid - directory containing the tiled FV3 orography and grid files (NetCDF).</li>
<li>orog_files_target_grid - names of the six tiled FV3 orography files.</li>
<li>vcoord_file_target_grid - path and name of the model vertical coordinate definition file (“global_hyblev.l$LEVS.txt).</li>
<li>data_dir_input_grid - directory containing the GRIB2 initial conditions data</li>
<li>grib2_file_input_grid - name of the GRIB2 input data file</li>
<li>varmap_file - path and name of the variable mapping (VARMAP) table. See below for details on this table.</li>
<li>input_type - input data type. Set to ‘grib2’</li>
<li>cycle_mon/day/hour - month/day/hour of your model initialization</li>
<li>convert_atm - set to ‘true’ to process the atmospheric fields</li>
<li>convert_sfc - set to ‘true’ to process the surface fields</li>
</ul>
<p>When using NEMSIO data as input to chgres_cube, set namelist as follows:</p>
<ul>
<li>fix_dir_target_grid - Path to the tiled FV3 surface climatological files (such as albedo).</li>
<li>mosaic_file_target_grid - Path and name of the FV3 mosaic file.</li>
<li>orog_dir_target_grid - directory containing the tiled FV3 orography and grid files (NetCDF).</li>
<li>orog_files_target_grid - names of the six tiled FV3 orography files.</li>
<li>vcoord_file_target_grid - path and name of the model vertical coordinate definition file (“global_hyblev.l$LEVS.txt).</li>
<li>data_dir_input_grid - directory containing the NEMSIO input data</li>
<li>atm_files_input_grid - name of the NEMSIO input atmospheric data file</li>
<li>sfc_files_input_grid - name of the NEMSIO input surface/Near Sea Surface Temperature (NSST) data file</li>
<li>input_type - input data type. Set to ‘gaussian_nemsio’.</li>
<li>cycle_mon/day/hour - month/day/hour of your model run</li>
<li>convert_atm - set to ‘true’ to process the atmospheric fields</li>
<li>convert_sfc - set to ‘true’ to process the surface fields</li>
<li>convert_nst - set to ‘true’ to process NSST fields</li>
<li>tracers_input - names of tracer records in input file. For GFDL microphysics, set to “spfh”,”clwmr”,”o3mr”,”icmr”,”rwmr”,”snmr”,”grle”.</li>
<li>tracers - names of tracer records in output file expected by model. For GFDL microphysics, set to “sphum”,”liq_wat”,”o3mr”,”ice_wat”,”rainwat”,”snowwat”,”graupel”.</li>
</ul>
<p>When using NetCDF data as input to chgres_cube, set namelist as follows:</p>
<ul>
<li>fix_dir_target_grid - Path to the tiled FV3 surface climatological files (such as albedo).</li>
<li>mosaic_file_target_grid - Path and name of the FV3 mosaic file.</li>
<li>orog_dir_target_grid - directory containing the tiled FV3 orography and grid files (NetCDF).</li>
<li>orog_files_target_grid - names of the six tiled FV3 orography files.</li>
<li>vcoord_file_target_grid - path and name of the model vertical coordinate definition file (“global_hyblev.l$LEVS.txt).</li>
<li>data_dir_input_grid - directory containing the NetCDF input data</li>
<li>atm_files_input_grid - name of the NetCDF input atmospheric data file</li>
<li>sfc_files_input_grid - name of the NetCDF input surface/Near Sea Surface Temperature (NSST) data file</li>
<li>input_type - input data type. Set to ‘gaussian_netcdf’.</li>
<li>cycle_mon/day/hour - month/day/hour of your model run</li>
<li>convert_atm - set to ‘true’ to process the atmospheric fields</li>
<li>convert_sfc - set to ‘true’ to process the surface fields</li>
<li>convert_nst - set to ‘true’ to process NSST fields</li>
<li>tracers_input - names of tracer records in input file. For GFDL microphysics, set to “spfh”,”clwmr”,”o3mr”,”icmr”,”rwmr”,”snmr”,”grle”.</li>
<li>tracers - names of tracer records in output file expected by model. For GFDL microphysics, set to “sphum”,”liq_wat”,”o3mr”,”ice_wat”,”rainwat”,”snowwat”,”graupel”.</li>
</ul>
<h1>Program inputs and outputs</h1>
<h2>Inputs</h2>
<p>The following four sets of files are located here: <a href="https://ftp.emc.ncep.noaa.gov/EIB/UFS/global/fix/fix_fv3_gmted2010.v20191213/">https://ftp.emc.ncep.noaa.gov/EIB/UFS/global/fix/fix_fv3_gmted2010.v20191213/</a></p>
<ul>
<li>FV3 mosaic file - (NetCDF format)<ul>
<li>CRES_mosaic.nc</li>
</ul>
</li>
<li>FV3 grid files - (NetCDF format)<ul>
<li>CRES_grid.tile1.nc</li>
<li>CRES_grid.tile2.nc</li>
<li>CRES_grid.tile3.nc</li>
<li>CRES_grid.tile4.nc</li>
<li>CRES_grid.tile5.nc</li>
<li>CRES_grid.tile6.nc</li>
</ul>
</li>
<li>FV3 orography files - (NetCDF format)<ul>
<li>CRES_oro_data.tile1.nc</li>
<li>CRES_oro_data.tile2.nc</li>
<li>CRES_oro_data.tile3.nc</li>
<li>CRES_oro_data.tile4.nc</li>
<li>CRES_oro_data.tile5.nc</li>
<li>CRES_oro_data.tile6.nc</li>
</ul>
</li>
<li>FV3 surface climatological files - Located under the ./fix_sfc sub-directory. One file for each tile. NetCDF format.<ul>
<li>CRES.facsf.tileX.nc (fractional coverage for strong/weak zenith angle dependent albedo)</li>
<li>CRES.maximum_snow_albedo.tileX.nc (maximum snow albedo)</li>
<li>CRES.slope_type.tileX.nc (slope type)</li>
<li>CRES.snowfree_albedo.tileX.nc (snow-free albedo)</li>
<li>CRES.soil_type.tileX.nc (soil type)</li>
<li>CRES.subtrate_temperature.tileX.nc (soil substrate temperature)</li>
<li>CRES.vegetation_greenness.tileX.nc (vegetation greenness)</li>
<li>CRES.vegetation_type.tileX.nc (vegetation type)</li>
</ul>
</li>
<li>FV3 vertical coordinate file. Text file. Located here: <a href="https://ftp.emc.ncep.noaa.gov/EIB/UFS/global/fix/fix_am.v20191213/">https://ftp.emc.ncep.noaa.gov/EIB/UFS/global/fix/fix_am.v20191213/</a><ul>
<li>global_hyblev.l$LEVS.txt</li>
</ul>
</li>
<li>Input data files. GRIB2, NEMSIO or NetCDF. See above section for how to find this data.</li>
</ul>
<h2>Outputs</h2>
<ul>
<li>Atmospheric “coldstart” files. NetCDF.<ul>
<li>out.atm.tile1.nc</li>
<li>out.atm.tile2.nc</li>
<li>out.atm.tile3.nc</li>
<li>out.atm.tile4.nc</li>
<li>out.atm.tile5.nc</li>
<li>out.atm.tile6.nc</li>
</ul>
</li>
<li>Surface/Near Sea Surface Temperature (NSST) “coldstart” files. NetCDF<ul>
<li>out.sfc.tile1.nc</li>
<li>out.sfc.tile1.nc</li>
<li>out.sfc.tile1.nc</li>
<li>out.sfc.tile1.nc</li>
<li>out.sfc.tile1.nc</li>
<li>out.sfc.tile1.nc</li>
</ul>
</li>
</ul>
<h1>Running the program stand alone</h1>
<ul>
<li>Locate your input files. See above for a list.</li>
<li>Set the namelist for your experiment. See above for an explanation of the namelist entries.</li>
<li>Link the namelist to Fortran unit number 41: <pre> ln -fs your-namelist-file ./fort.41</pre></li>
<li>Load any required runtime libraries. For example, you may need to load libraries for NetCDF and/or your Fortran compiler.</li>
<li>Run the program with an MPI task count that is a multiple of six. This is an ESMF library requirement when processing a six-tiled global grid.</li>
</ul>
<h1>Variable Mapping (VARMAP) table</h1>
<p>The VARMAP table, set in the chgres_cube namelist (variable varmap_file), controls how chgres_cube handles variables that might be missing from the GRIB2 files. Since there are so many different versions of GRIB2 files, it's often uncertain what fields are available even if you know what source model the data is coming from. Each file contains the following: (Note, only the GFS physics suite is currently supported.)</p>
<p>Column 1: Name the code searches for in the table. Do not change. Some definitions:</p>
<ul>
<li>dzdt - vertical velocity</li>
<li>sphum - specific humidity</li>
<li>liq_wat - liquid water mixing ratio</li>
<li>o3mr - ozone mixing ratio</li>
<li>ice_wat - ice water mixing ratio</li>
<li>rainwat - rain water mixing ratio</li>
<li>snowwat - snow water mixing ratio</li>
<li>graupel - graupel mixing ratio</li>
<li>vtype - vegetation type</li>
<li>sotype - soil type</li>
<li>vfrac - plant greenness fraction</li>
<li>fricv - friction velocity</li>
<li>sfcr - roughness length</li>
<li>tprcp - precipitation rate</li>
<li>ffmm - surface exchange coefficient for momentum</li>
<li>ffhh - surface exchange coefficient for heat</li>
<li>f10m - log((sfcr+10)/sfcr)</li>
<li>soilw - total volumetric soil moisture</li>
<li>soill - liquid volumetric soil moisture</li>
<li>soilt - soil column temperature</li>
<li>cnwat - plant canopy water content</li>
<li>hice - sea/lake ice thickness</li>
<li>weasd - snow liquid equivalent</li>
<li>snod - physical snow depth</li>
</ul>
<p>Column 2: Name of the variable in the output “coldstart” files. Unimplemented.</p>
<p>Column 3: Behavior when the code can't find the variable in the input file. Options are:</p>
<ul>
<li>"skip": Don't write to the output file.</li>
<li>"set_to_fill": Set to user-specified field value (see column 4).</li>
<li>"intrp": LnP interpolation to missing levels. No extrapolation allowd.</li>
<li>"stop": Force an exception and stop code execution. Use this if you absolutely require a field to be present.</li>
</ul>
<p>Column 4: If column 3 = "set_to_fill", then this value is used to fill in all points in the input field. These values may be overwritten by the code before output depending on the variable (especially for surface variables).</p>
<p>Column 5: Variable type descriptor. Variable names designated as tracers are used to populate the list of tracers to read from the GRIB2 file and write to output, so make sure all tracers you wish to read have an entry. Note that if you wish to add a tracer name that is not already included in the appropriate VARMAP file, this will require modification of the chgres_cube code. Valid choices are:</p>
<ul>
<li>“T”: 3-dimensional tracer array</li>
<li>“D”: 3-dimensional non-tracer array</li>
<li>“S”: 2-dimensional surface array </li>
</ul>
</div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.5 </li>
  </ul>
</div>
</body>
</html>
